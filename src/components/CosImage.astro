---
import { Image } from 'astro:assets'

interface Props {
  src: string | URL // path or full URL, eg. 'icon.webp' or URL('https://cos.xivstrat.cn/icon.webp')
  alt?: string
  [key: string]: unknown
}

const { src, alt, ...rest }: Props = Astro.props

const url = typeof src === 'string' ? new URL(src, import.meta.env.PUBLIC_COS_BASE_URL) : src
const width = url.searchParams.get('width')
const height = url.searchParams.get('height')

url.searchParams.delete('width')
url.searchParams.delete('height')

const inferSize = width === null || height === null
---

{
  inferSize ? (
    <Image src={url.href} alt={alt ?? ""} inferSize {...rest} />
  ) : (
    <Image
      src={url.href}
      alt={alt ?? ""}
      width={parseInt(width, 10)}
      height={parseInt(height, 10)}
      {...rest}
    />
  )
}
